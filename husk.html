<!DOCTYPE html>
<html lang="da">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
<title>Flashwords</title>
<link href="https://fonts.googleapis.com/css2?family=Comic+Neue:wght@700&display=swap" rel="stylesheet">
<style>
  body {
    margin: 0;
    padding: 0;
    font-family: 'Comic Neue', cursive;
    min-height: 100vh;
    overflow: hidden;
    background: linear-gradient(270deg, #1a1a2e, #2e2e3f, #3a3a4f, #1f1c2c);
    background-size: 800% 800%;
    animation: gradientBG 60s ease infinite;
  }

  @keyframes gradientBG {
    0% {background-position: 0% 50%;}
    50% {background-position: 100% 50%;}
    100% {background-position: 0% 50%;}
  }

  .particle {
    position: absolute;
    font-weight: bold;
    pointer-events: none;
    user-select: none;
    text-align: center;
    font-size: clamp(2rem, 6vw, 4rem);
    background: linear-gradient(45deg, #ff9a9e, #fad0c4, #ffd700, #1fdbff, #ff6f61);
    background-size: 400% 400%;
    animation: gradientText 5s ease infinite;
    -webkit-background-clip: text;
    -webkit-text-fill-color: transparent;
    text-shadow: 0 0 10px rgba(0,0,0,0.5);
    transition: transform 3s ease, left 3s ease, top 3s ease;
  }

  @keyframes gradientText {
    0% {background-position: 0% 50%;}
    50% {background-position: 100% 50%;}
    100% {background-position: 0% 50%;}
  }

  .translation {
    font-size: 0.5em;
    display: block;
    margin-top: 0.2em;
    color: #ffffff;
    text-shadow: 0 0 5px rgba(0,0,0,0.8);
  }
</style>
</head>
<body>

<script>
const maxRepeats = 5;

// TTS с кастомной скоростью
function speak(text, lang = 'da', rate = 0.9) {
  return new Promise(resolve => {
    const utter = new SpeechSynthesisUtterance(text);
    utter.lang = lang;
    utter.rate = rate;
    utter.onend = resolve;
    speechSynthesis.speak(utter);
  });
}

// случайная позиция на экране
function randomPosition(element) {
  const vw = window.innerWidth;
  const vh = window.innerHeight;
  const x = Math.random() * (vw - element.offsetWidth);
  const y = Math.random() * (vh - element.offsetHeight);
  return {x, y};
}

// плавное перемещение
function moveTo(element, x, y) {
  element.style.left = `${x}px`;
  element.style.top = `${y}px`;
}

async function showWord(wordObj) {
  const span = document.createElement('div');
  span.className = 'particle';
  span.innerHTML = `${wordObj.danish}<span class="translation">${wordObj.translation}</span>`;
  document.body.appendChild(span);

  let pos = randomPosition(span);
  moveTo(span, pos.x, pos.y);

  // Первый показ: перевод + медленное датское слово
  await speak(wordObj.translation, 'ru-RU');
  await speak(wordObj.danish, 'da-DK', 0.5);

  // Второй и третий показ: ускоряем
  const speedSteps = [0.7, 0.9];
  for (let i = 1; i < maxRepeats - 1; i++) {
    await new Promise(r => setTimeout(r, 1500));
    pos = randomPosition(span);
    moveTo(span, pos.x, pos.y);
    
    let rate = (i <= speedSteps.length) ? speedSteps[i-1] : 1.0;
    await speak(wordObj.danish, 'da-DK', rate);
  }

  // Последний показ: перевод + нормальное датское слово
  await new Promise(r => setTimeout(r, 1500));
  pos = randomPosition(span);
  moveTo(span, pos.x, pos.y);
  await speak(wordObj.translation, 'ru-RU');
  await speak(wordObj.danish, 'da-DK', 1.0);

  span.remove();
}

async function startSession(words) {
  for (const word of words) {
    await showWord(word);
  }
}

// Загрузка слов из dic.json
fetch('dic.json')
  .then(response => response.json())
  .then(data => {
    const words = data.map(item => ({
      danish: item.word,
      translation: item.value
    }));
    startSession(words);
  })
  .catch(err => console.error('Ошибка загрузки dic.json:', err));
</script>

</body>
</html>
